{"version":3,"file":"111.parkhang-dev.js","sources":["webpack://parkhang/./app/components/MediaComponent/Video.js"],"sourcesContent":["import React, { useRef, useEffect, useState, useCallback } from \"react\";\r\nimport ReactPlayer from \"react-player\";\r\nimport _ from \"lodash\";\r\nimport { Collapse } from \"@mui/material\";\r\n\r\nfunction toHMS(seconds) {\r\n    var date = new Date(null);\r\n    date.setSeconds(seconds);\r\n    return date.toISOString().substr(11, 8);\r\n}\r\nfunction toSec(hms = \"\") {\r\n    var a = hms.split(\":\"); // split it at the colons\r\n    // minutes are worth 60 seconds. Hours are worth 60 minutes.\r\n    var seconds = +a[0] * 60 * 60 + +a[1] * 60 + +a[2];\r\n    return seconds;\r\n}\r\nfunction calTimeToSeek(maxValue, currentTime) {\r\n    let i = toSec(currentTime) / maxValue;\r\n    return parseFloat(i);\r\n}\r\nfunction getClosestNumber(arr, d) {\r\n    return arr.reduce((a, b) => (b <= d && a < b ? b : a), 0);\r\n}\r\nfunction Video(props) {\r\n    let textIdfromAlignment = props.alignmentData.text;\r\n    let sourceId = props?.videoData?.source?.text;\r\n    const VideoData = props?.videoData?.alignment || [];\r\n    const url = \"https://www.youtube.com/watch?v=2MMM_ggekfE\";\r\n    const [interval, setInterval] = useState({});\r\n    let VideoIdList = [];\r\n\r\n    // const syncIdOnScroll = props.syncIdOnScroll;\r\n    const syncIdOnClick = props.syncIdOnClick;\r\n    const [state, setState] = useState({\r\n        played: 0,\r\n        duration: 0,\r\n        playing: true,\r\n    });\r\n    if (!_.isEmpty(VideoData)) {\r\n        VideoIdList = VideoData.map((l) => parseInt(l.source_segment.start));\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (textIdfromAlignment === props.selectedText.id) {\r\n            //     let intersection = syncIdOnScroll.filter(element => VideoIdList.includes(element));\r\n            //     newList= VideoData.filter(d=>d.source_segment===intersection[0]);\r\n            //     jumpToTime(newList[0]?.target_segment.start)\r\n            let ClickId = syncIdOnClick;\r\n            let closestID = getClosestNumber(VideoIdList, ClickId);\r\n            let data = VideoData.find(\r\n                (l) => l.source_segment.start === closestID.toString()\r\n            );\r\n            if (!_.isEmpty(data)) {\r\n                jumpToTime(data.target_segment.start);\r\n            }\r\n        }\r\n    }, [syncIdOnClick]);\r\n\r\n    const changeTextBackground = useCallback(() => {\r\n        let current = interval;\r\n        if (textIdfromAlignment === props.selectedText.id) {\r\n            for (let i = current.start; i < current.end; i++) {\r\n                let currentIds = document.getElementById(`s_${i}`);\r\n                if (currentIds) {\r\n                    currentIds.style.fontWeight = \"bold\";\r\n                }\r\n            }\r\n        }\r\n    }, [interval.start]);\r\n\r\n    useEffect(() => {\r\n        let timer = setTimeout(() => changeTextBackground(), 800);\r\n        let current = interval;\r\n        if (interval.start) {\r\n            props.changeScrollToId({\r\n                id: current.start || null,\r\n                from: \"video\",\r\n            });\r\n        }\r\n        return () => {\r\n            clearTimeout(timer);\r\n            for (let i = current.start; i < current.end; i++) {\r\n                let currentIds = document.getElementById(`s_${i}`);\r\n                if (currentIds) {\r\n                    currentIds.style.fontWeight = \"normal\";\r\n                }\r\n            }\r\n        };\r\n    }, [interval.start]);\r\n\r\n    const videoRef = useRef();\r\n\r\n    const jumpToTime = (time) => {\r\n        let newData = calTimeToSeek(state.duration, time);\r\n        videoRef.current.seekTo(parseFloat(newData));\r\n    };\r\n\r\n    const handleProgress = (e) => {\r\n        const played = e.playedSeconds;\r\n        const Interval = VideoData.find(\r\n            (time) =>\r\n                toSec(time.target_segment.start) < played &&\r\n                toSec(time.target_segment.end) > played\r\n        );\r\n        if (!_.isEmpty(Interval)) {\r\n            let source_segment = Interval.source_segment;\r\n            changeTextBackground();\r\n            setInterval({ ...source_segment });\r\n        }\r\n    };\r\n    if (VideoData.length === 0) return <div />;\r\n    if (sourceId !== props.selectedText.id) return <div />;\r\n    return (\r\n        <Collapse in={props.open}>\r\n            <ReactPlayer\r\n                url={url}\r\n                style={{ maxWidth: \"100%\" }}\r\n                ref={videoRef}\r\n                controls={true}\r\n                onDuration={(duration) =>\r\n                    setState({ ...state, duration: duration })\r\n                }\r\n                light\r\n                playing\r\n                onPlay={() => setState({ ...state, playing: true })}\r\n                onPause={() => setState({ ...state, playing: false })}\r\n                onProgress={handleProgress}\r\n                onError={() => console.log(\"error in media sec\")}\r\n            />\r\n        </Collapse>\r\n    );\r\n}\r\n\r\nexport default Video;\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AAHA;AAAA;AAAA;AAAA;AACA;AAIA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAEA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AADA;AAGA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAbA;AAiBA;AACA;AACA;;;;A","sourceRoot":""}